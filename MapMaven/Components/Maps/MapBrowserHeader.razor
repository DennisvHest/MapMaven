@inherits ReactiveComponent

@using MapMaven.Core.Services;
@using MapMaven.Core.Utilities.Scoresaber

<MudTh></MudTh>
<MudTh></MudTh>
<MudTh>
    <MudTableSortLabel SortBy="new Func<Map, object>(x => x.Name)">Name</MudTableSortLabel>
</MudTh>
<MudTh>
    <MudTableSortLabel SortBy="new Func<Map, object>(x => x.SongAuthorName)">Song Author</MudTableSortLabel>
</MudTh>
<MudTh>
    <MudTableSortLabel SortBy="new Func<Map, object>(x => x.MapAuthorName)">Map Author</MudTableSortLabel>
</MudTh>
<MudTh>
    <MudTableSortLabel SortBy="new Func<Map, object>(x => x.SongDuration)">Duration</MudTableSortLabel>
</MudTh>
@if (!string.IsNullOrEmpty(PlayerId))
{
    <MudTh>
        <MudTableSortLabel SortBy="new Func<Map, object>(x => x.PlayerScore?.AccuracyWithMods())">%</MudTableSortLabel>
    </MudTh>
    <MudTh>
        <MudTableSortLabel SortBy="new Func<Map, object>(x => x.PlayerScore?.Score?.Pp)">pp</MudTableSortLabel>
    </MudTh>
    <MudTh>
        <MudTableSortLabel SortBy="new Func<Map, object>(x => x.ScoreEstimates.Any() ? x.ScoreEstimates.Max(x => x.PPIncrease) : 0)">
            <MudIcon Icon="@Icons.Filled.KeyboardDoubleArrowUp"></MudIcon>pp
        </MudTableSortLabel>
    </MudTh>
    <MudTh>
        <MudTableSortLabel SortBy="new Func<Map, object>(x => !(x.PlayerScore?.Score?.HasReplay ?? false))"><img src="images/replay-icon.png" style="width: 24px" /></MudTableSortLabel>
    </MudTh>
}
<MudTh></MudTh>

@code {
    [Inject]
    ScoreSaberService ScoreSaberService { get; set; }

    public string? PlayerId { get; set; } = null;

    protected override void OnInitialized()
    {
        SubscribeAndBind(ScoreSaberService.PlayerIdObservable, playerId => PlayerId = playerId);
    }
}
